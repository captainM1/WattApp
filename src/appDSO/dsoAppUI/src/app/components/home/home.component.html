<app-nav></app-nav>
<div class="outer" style="margin-top: 90px; margin-left: 0; margin-right: 0;">
   
    <button mat-button (click)="openDialog2()">OPEN 2</button>
<div class="container">
    <!-- WEATHER -->
            <div class="row" >
                <h2 class="text-center">Weather Details</h2>
                <ngx-spinner bdColor = "rgba(0, 0, 0, 0.5)" size = "medium" color = "#fff" type = "ball-spin" [showSpinner]="weatherLoader" [fullScreen]="false" *ngIf="weatherLoader"><p style="color: #fff; " > Please wait... </p></ngx-spinner>

                <div class="date">
                    <p class="time">{{ currentDate | async | date }}</p>
                    <p class="date">{{ currentDate | async | date:'HH:mm:ss' }}</p>
                </div>
                <div class="col-sm-4" id = "weather_div">
                    <p class="text-left"  *ngIf="weather">
                        <img src="../../../assets/icons/weather-icons/compass.png" ><small>Your Time Zone:</small> {{ this.weather.timezone}}
                    </p>
                    <p class="text-left" *ngIf="weather.current_weather">
                      <img src="../../../assets/icons/weather-icons/temperature(2).png"><small>Temperature:</small> {{ this.weather.current_weather.temperature }} °C
                    </p>
                    <p class="text-left">
                        <img src="../../../assets/icons/weather-icons/hot.png"><small>Maximal Temperature: </small> {{ this.weather.daily.temperature_2m_max[0]}} °C
                      </p>
                </div>
                <div class="col-sm-4" style="padding-top: 20px;margin-right: -20px; padding-top: 20px; padding-right: 60px; padding-left: 60px;">
                    <p class="text-left" *ngIf="weather">
                        <img src="../../../assets/icons/weather-icons/cold.png"><small>Minimal Temperature:</small> {{ this.weather.daily.temperature_2m_min[0]}} °C
                      </p>
                      <p class="text-left" *ngIf="weather.current_weather">
                        <img src="../../../assets/icons/weather-icons/storm.png"><small>Wind Speed:</small> {{ this.weather.current_weather.windspeed}} km/h
                      </p>
                      <p class="text-left">
                        <img src="../../../assets/icons/weather-icons/humidity.png"><small>Humidity:</small> {{ this.weather.hourly.relativehumidity_2m[0]}} %
                      </p>
                </div>
                <div class="col-sm-4">
                    <canvas #hourlyTemp style="width: 300px; height: 150px;"></canvas>
                </div>
            </div>
    <!-- TOTAL DEVICES  -->
            <div class="row">
                <h2 class="text-center">Device Details</h2>
                <div class="card-container">
                    <div class="card">
                        <h3 class="card-title" >Total devices:</h3>
                        <p class="card-text" >{{total}}</p>
                    </div>
                    <div class="card">
                        <h3 class="card-title" >Prosumers:</h3>
                        <p class="card-text" *ngIf="producers.length">{{producers.length}}</p>
                    </div>
                    <div class="card">
                        <h3 class="card-title" >Consumers:</h3>
                        <p class="card-text" >{{consumers.length}}
                        </p>
                        </div>
                    <div class="card">
                        <h3 class="card-title" >Storage:</h3>
                        <p class="card-text" >{{storage.length}}</p>
                    </div>
                  </div>
                  <div class="row">
                    <h2 class="text-center">Energy Consumption and Production for the entire system </h2>
                    <div class="style-info">
                            <li class = "info">
                              <i class="fa fa-square" aria-hidden="true" style="color:#62C370"></i> Green zone (up to 350 kWh)
                            </li>
                            <li class = "info" >
                              <i class="fa fa-square" aria-hidden="true" style="color:#EC7357"></i> Orange zone (from 350kWh to 700kWh)
                            </li>
                            <li class = "info">
                              <i class="fa fa-square" aria-hidden="true" style="color:#F42C04"></i> Red zone (over 700kWh)
                            </li>
                    </div>
                    <div class="card-container">
                        <div class="card" >
                            <label for="graphSelect">Select Graph:</label>
                            <select [(ngModel)]="selectedGraph" (click)="displayGraphConsumption(selectedGraph)">
                                <option value="current">Current Consumption</option>
                                <option value="prevMonth">Previous Month Consumption</option>
                                <option value="nextMonth">Next Month Consumption</option>
                            </select>
                            
                            <div class="card-body" *ngIf="selectedGraph === 'current'" >
                                <!-- <button mat-button (click)="openDialog1()"><i class="fa fa-table" aria-hidden="true"></i>
                                </button> -->
                                <div class="graph-style">
                                    <ngx-spinner bdColor = "rgba(0, 0, 0, 0.5)" size = "medium" color = "#fff" type = "ball-spin" [showSpinner]="consumptionCurrentLoader" [fullScreen]="false" *ngIf="consumptionCurrentLoader"><p style="color: #fff; margin-top:60px;"> Please wait... </p></ngx-spinner>
                                    <canvas #currentConsumptionSYS></canvas>
                                </div>
                                <p class="card-text" id = "text-consumption-production" [ngClass]="{'green': currentConsumptionSys <= 350, 'blue': currentConsumptionSys >= 350 && currentConsumptionSys < 700, 'red':currentConsumptionSys >= 700 }">{{currentConsumptionSys}} kWh</p>
                                <i class="fa fa-bolt" [ngClass]="{'green': razlika > 0, 'red': razlika <= 0}" ><span>  {{razlika}}  % {{text}}</span></i>
                            </div>
                            
                            <div class="card-body" *ngIf="selectedGraph === 'prevMonth'">
                                <div class="graph-style">
                                    <ngx-spinner bdColor = "rgba(0, 0, 0, 0.5)" size = "medium" color = "#fff" type = "ball-spin" [showSpinner]="consumptionPrevMonthLoader" [fullScreen]="false" *ngIf="consumptionPrevMonthLoader"><p style="color: #fff; margin-top:60px;"> Please wait... </p></ngx-spinner>
                                    <canvas #prevMonthConsumptionSYS></canvas>
                                </div>
                                <p class="card-text" id = "text-consumption-production" [ngClass]="{'green': prevMonthConsumptionSys <= 350, 'blue': prevMonthConsumptionSys >= 350 && prevMonthConsumptionSys < 700, 'red':prevMonthConsumptionSys >= 700 }">{{prevMonthConsumptionSys}} kWh</p>
                            </div>
                            <div class="card-body" *ngIf="selectedGraph === 'nextMonth'">
                                <div class="graph-style">
                                    <ngx-spinner bdColor = "rgba(0, 0, 0, 0.5)" size = "medium" color = "#fff" type = "ball-spin" [showSpinner]="consumptionNextMonthLoader" [fullScreen]="false" *ngIf="consumptionNextMonthLoader"><p style="color: #fff; margin-top:60px;"> Please wait... </p></ngx-spinner>
                                    <canvas #nextMonthConsumptionSYS></canvas>
                                </div>
                                <p class="card-text" id = "text-consumption-production" [ngClass]="{'green': nextMonthConsumptionSys <= 350, 'blue': nextMonthConsumptionSys >= 350 && nextMonthConsumptionSys < 700, 'red':nextMonthConsumptionSys >= 700 }">{{nextMonthConsumptionSys}} kWh</p>
                            </div>
                        </div> 
                    <div class="card" >
                        <label for="graphSelect">Select Graph:</label>
                        <select [(ngModel)]="selectedGraphProduction" (click)="displayGraphProduction(selectedGraphProduction)">
                            <option value="current">Current Production</option>
                            <option value="prevMonth">Previous Month Production</option>
                            <option value="nextMonth">Next Month Production</option>
                        </select>
                        <div class="card-body" *ngIf="selectedGraphProduction === 'current'">
                            <div class="graph-style">
                                <ngx-spinner bdColor = "rgba(0, 0, 0, 0.5)" size = "medium" color = "#fff" type = "ball-spin" [showSpinner]="productionCurrentLoader" [fullScreen]="false" *ngIf="productionCurrentLoader"><p style="color: #fff; margin-top:60px;"> Please wait... </p></ngx-spinner>
                                <canvas #currentProductionSYS></canvas>
                            </div>
                            <p class="card-text" id = "text-consumption-production" [ngClass]="{'green': currentProductionSys <= 350, 'blue': currentProductionSys >= 350 && currentProductionSys < 700, 'red':currentProductionSys >= 700 }">{{currentProductionSys}} kWh</p>
                            <i class="fa fa-bolt"  [ngClass]="{'green': razlika > 0, 'red': razlika <= 0}"><span>  {{razlika1}} % {{text1}}</span></i>
                        </div>
                        <div class="card-body" *ngIf="selectedGraphProduction === 'prevMonth'">
                            <div class="graph-style">
                                <ngx-spinner bdColor = "rgba(0, 0, 0, 0.5)" size = "medium" color = "#fff" type = "ball-spin" [showSpinner]="productionPrevMonthLoader" [fullScreen]="false" *ngIf="productionPrevMonthLoader"><p style="color: #fff; margin-top:60px;"> Please wait... </p></ngx-spinner>
                                <canvas #prevMonthProductionSYS></canvas>
                            </div>
                            <p class="card-text" id = "text-consumption-production" [ngClass]="{'green': prevMonthProductionSys <= 350, 'blue': prevMonthProductionSys >= 350 && prevMonthProductionSys < 700, 'red':prevMonthProductionSys >= 700 }">{{prevMonthProductionSys}} kWh</p>
                        </div>
                        <div class="card-body" *ngIf="selectedGraphProduction === 'nextMonth'">
                            <div class="graph-style">
                                <ngx-spinner bdColor = "rgba(0, 0, 0, 0.5)" size = "medium" color = "#fff" type = "ball-spin" [showSpinner]="nextMonthProductionLoader" [fullScreen]="false" *ngIf="nextMonthProductionLoader"><p style="color: #fff; margin-top:60px;"> Please wait... </p></ngx-spinner>
                                <canvas #nextMonthProductionSYS></canvas>
                            </div>
                            <p class="card-text" id = "text-consumption-production" [ngClass]="{'green': nextMonthProductionSys <= 350, 'blue': nextMonthProductionSys >= 350 && nextMonthProductionSys < 700, 'red':nextMonthProductionSys >= 700 }">{{nextMonthProductionSys}} kWh</p>
                        </div>
                    </div>
                    <div class="card" id = "card-lg">
                        <p class="card-title" id = "card-title-lg">
                            Consumption & Production 
                        </p>
                       <div class="card-body">
                            <div>
                                <ngx-spinner bdColor = "rgba(0, 0, 0, 0.5)" size = "medium" color = "#fff" type = "ball-spin" [showSpinner]="currentProductionDayLoader " [fullScreen]="false" *ngIf="currentProductionDayLoader "><p style="color: #fff; margin-top:60px;"> Please wait... </p></ngx-spinner>
                                <canvas #consumptionProduction></canvas>
                            </div>
                       </div>
                   </div>
                </div>

                <div class="container">
                    <div class="row">
                        <div class="col">
                            <label for="graphSelect">Select Graph:</label>
                            <select [(ngModel)]="selectedGraphHistoryConsumption" (ngModelChange)="HistoryConsumption()">
                              <option value="month">Previous Month</option>
                              <option value="7days">Previous 7 Days</option>
                              <option value="24h">Previous 24 Hours</option>
                            </select>
                            
                            <div class="card" id = "card-consumption" *ngIf="selectedGraphHistoryConsumption === 'month'">
                                <div class="card-body">
                                     <div>
                                        <ngx-spinner bdColor = "rgba(0, 0, 0, 0.5)" size = "medium" color = "#fff" type = "ball-spin" [showSpinner]="consumptionPreviousMonthLoader " [fullScreen]="false" *ngIf="consumptionPreviousMonthLoader "><p style="color: #fff; margin-top:60px;"> Please wait... </p></ngx-spinner>
                                        <canvas  #consumptionPrevMonthGraph></canvas>
                                     </div>
                                </div>
                            </div>

                            <div class="card" id = "card-consumption"  *ngIf="selectedGraphHistoryConsumption === '7days'">
                                <div class="card-body">
                                     <div>
                                        <ngx-spinner bdColor = "rgba(0, 0, 0, 0.5)" size = "medium" color = "#fff" type = "ball-spin" [showSpinner]="consumptionPrev7DaysLoader " [fullScreen]="false" *ngIf="consumptionPrev7DaysLoader "><p style="color: #fff; margin-top:60px;"> Please wait... </p></ngx-spinner>
                                        <canvas #consumptionPrev7daysGraph></canvas>
                                     </div>
                                </div>
                            </div>
                            
                            <div class="card" id = "card-consumption" *ngIf="selectedGraphHistoryConsumption === '24h'">
                               <div class="card-body">
                                    <div>
                                        <ngx-spinner bdColor = "rgba(0, 0, 0, 0.5)" size = "medium" color = "#fff" type = "ball-spin" [showSpinner]="consumptionPrev24hLoader " [fullScreen]="false" *ngIf="consumptionPrev24hLoader "><p style="color: #fff; margin-top:60px;"> Please wait... </p></ngx-spinner>
                                        <canvas #previous24ConsumptionGraph></canvas>
                                    </div>
                               </div>
                           </div>
                        </div>
                        <div class="col">
                            <label for="graphSelect">Select Graph:</label>
                            <select [(ngModel)]="selectedGraphFutureConsumption" (ngModelChange)="FutureConsumption()">
                              <option value="month">Previous Month</option>
                              <option value="7days">Previous 7 Days</option>
                              <option value="24h">Previous 24 Hours</option>
                            </select>
                            
                            <div class="card" id = "card-consumption" *ngIf="selectedGraphFutureConsumption === 'month'">
                                <div class="card-body">
                                     <div>
                                        <ngx-spinner bdColor = "rgba(0, 0, 0, 0.5)" size = "medium" color = "#fff" type = "ball-spin" [showSpinner]="consumptionPreviousMonthLoader " [fullScreen]="false" *ngIf="consumptionPreviousMonthLoader "><p style="color: #fff; margin-top:60px;"> Please wait... </p></ngx-spinner>
                                        <canvas  #consumptionPrevMonthGraph></canvas>
                                     </div>
                                </div>
                            </div>

                            <div class="card" id = "card-consumption"  *ngIf="selectedGraphFutureConsumption === '7days'">
                                <div class="card-body">
                                     <div>
                                        <ngx-spinner bdColor = "rgba(0, 0, 0, 0.5)" size = "medium" color = "#fff" type = "ball-spin" [showSpinner]="consumptionPrev7DaysLoader " [fullScreen]="false" *ngIf="consumptionPrev7DaysLoader "><p style="color: #fff; margin-top:60px;"> Please wait... </p></ngx-spinner>
                                        <canvas #consumptionPrev7daysGraph></canvas>
                                     </div>
                                </div>
                            </div>
                            
                            <div class="card" id = "card-consumption" *ngIf="selectedGraphFutureConsumption === '24h'">
                               <div class="card-body">
                                    <div>
                                        <ngx-spinner bdColor = "rgba(0, 0, 0, 0.5)" size = "medium" color = "#fff" type = "ball-spin" [showSpinner]="consumptionPrev24hLoader " [fullScreen]="false" *ngIf="consumptionPrev24hLoader "><p style="color: #fff; margin-top:60px;"> Please wait... </p></ngx-spinner>
                                        <canvas #previous24ConsumptionGraph></canvas>
                                    </div>
                               </div>
                           </div>
                        </div>
                    </div>
                </div>
         </div>
       </div>
    </div>

        
 
       
    
   

